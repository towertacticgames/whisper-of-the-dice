<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üîÆ Whisper of the Dice ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÅ‡∏î‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</title>
    
    <!-- Import Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Athiti:wght@400;500;600;700&family=Kanit:wght@300;400;500;600&family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- html-to-image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>

    <style>
        :root {
            --primary-color: #2a2d43; 
            --secondary-color: #4a4e69; 
            --accent-color: #c9ada7; 
            --highlight-color: #d4a373; 
            --bg-color: #130023;
            --white: #ffffff;
            --card-radius: 20px;
            
            /* --- Backgrounds --- */
            --intro-background: url('images/intro_background.png');
            
            /* Quiz Backgrounds */
            --quiz-first-background: url('images/quiz_bg_1.png');
            --quiz-second-background: url('images/quiz_bg_2.png');
            --quiz-third-background: url('images/quiz_bg_3.png');
            --quiz-fourth-background: url('images/quiz_bg_4.png');
            --quiz-fifth-background: url('images/quiz_bg_5.png');
            --quiz-sixth-background: url('images/quiz_bg_6.png');
            --quiz-seventh-background: url('images/quiz_bg_7.png');

            /* --- Card Images --- */
            --card-back: url('images/card_back.png');
            
            --card-front-thefool: url('images/card_the_fool.png');
            --card-front-themagician: url('images/card_the_magician.png');
            --card-front-thehighpriestess: url('images/card_the_high_priestess.png');
            --card-front-theempress: url('images/card_the_empress.png');
            --card-front-theemperor: url('images/card_the_emperor.png');
            --card-front-thehierophant: url('images/card_the_hierophant.png');
            --card-front-thelovers: url('images/card_the_lovers.png');
            --card-front-thechariot: url('images/card_the_chariot.png');
            --card-front-strength: url('images/card_strength.png');
            --card-front-thehermit: url('images/card_the_hermit.png');
            --card-front-wheeloffortune: url('images/card_wheel_of_fortune.png');
            --card-front-justice: url('images/card_justice.png');
            --card-front-thehangedman: url('images/card_the_hanged_man.png');
            --card-front-death: url('images/card_death.png');
            --card-front-temperance: url('images/card_temperance.png');
            --card-front-thedevil: url('images/card_the_devil.png');
            --card-front-thetower: url('images/card_the_tower.png');
            --card-front-thestar: url('images/card_the_star.png');
            --card-front-themoon: url('images/card_the_moon.png');
            --card-front-thesun: url('images/card_the_sun.png');
            --card-front-judgement: url('images/card_judgement.png');
            --card-front-theworld: url('images/card_the_world.png');

            /* --- Result Summary Images (9:16 for Image Tag) --- */
            --result-img-thefool: url('images/summary_the_fool.png');
            --result-img-themagician: url('images/summary_the_magician.png');
            --result-img-thehighpriestess: url('images/summary_the_high_priestess.png');
            --result-img-theempress: url('images/summary_the_empress.png');
            --result-img-theemperor: url('images/summary_the_emperor.png');
            --result-img-thehierophant: url('images/summary_the_hierophant.png');
            --result-img-thelovers: url('images/summary_the_lovers.png');
            --result-img-thechariot: url('images/summary_the_chariot.png');
            --result-img-strength: url('images/summary_strength.png');
            --result-img-thehermit: url('images/summary_the_hermit.png');
            --result-img-wheeloffortune: url('images/summary_wheel_of_fortune.png');
            --result-img-justice: url('images/summary_justice.png');
            --result-img-thehangedman: url('images/summary_the_hanged_man.png');
            --result-img-death: url('images/summary_death.png');
            --result-img-temperance: url('images/summary_temperance.png');
            --result-img-thedevil: url('images/summary_the_devil.png');
            --result-img-thetower: url('images/summary_the_tower.png');
            --result-img-thestar: url('images/summary_the_star.png');
            --result-img-themoon: url('images/summary_the_moon.png');
            --result-img-thesun: url('images/summary_the_sun.png');
            --result-img-judgement: url('images/summary_judgement.png');
            --result-img-theworld: url('images/summary_the_world.png');

            /* --- Result Backgrounds (For Fullscreen Blurred BG) --- */
            --result-thefool-background: url('images/result_the_fool.png');
            --result-themagician-background: url('images/result_the_magician.png');
            --result-thehighpriestess-background: url('images/result_the_high_priestess.png');
            --result-theempress-background: url('images/result_the_empress.png');
            --result-theemperor-background: url('images/result_the_emperor.png');
            --result-thehierophant-background: url('images/result_the_hierophant.png');
            --result-thelovers-background: url('images/result_the_lovers.png');
            --result-thechariot-background: url('images/result_the_chariot.png');
            --result-strength-background: url('images/result_strength.png');
            --result-thehermit-background: url('images/result_the_hermit.png');
            --result-wheeloffortune-background: url('images/result_wheel_of_fortune.png');
            --result-justice-background: url('images/result_justice.png');
            --result-thehangedman-background: url('images/result_the_hanged_man.png');
            --result-death-background: url('images/result_death.png');
            --result-temperance-background: url('images/result_temperance.png');
            --result-thedevil-background: url('images/result_the_devil.png');
            --result-thetower-background: url('images/result_the_tower.png');
            --result-thestar-background: url('images/result_the_star.png');
            --result-themoon-background: url('images/result_the_moon.png');
            --result-thesun-background: url('images/result_the_sun.png');
            --result-judgement-background: url('images/result_judgement.png');
            --result-theworld-background: url('images/result_the_world.png');
            
            --result-fallback-background: linear-gradient(to bottom right, #ffffff, #f8f9fa);

            /* --- Popup Backgrounds (9:16) --- */
            --popup-bg-thefool: url('images/popup_bg_the_fool.png');
            --popup-bg-themagician: url('images/popup_bg_the_magician.png');
            --popup-bg-thehighpriestess: url('images/popup_bg_the_high_priestess.png');
            --popup-bg-theempress: url('images/popup_bg_the_empress.png');
            --popup-bg-theemperor: url('images/popup_bg_the_emperor.png');
            --popup-bg-thehierophant: url('images/popup_bg_the_hierophant.png');
            --popup-bg-thelovers: url('images/popup_bg_the_lovers.png');
            --popup-bg-thechariot: url('images/popup_bg_the_chariot.png');
            --popup-bg-strength: url('images/popup_bg_strength.png');
            --popup-bg-thehermit: url('images/popup_bg_the_hermit.png');
            --popup-bg-wheeloffortune: url('images/popup_bg_wheel_of_fortune.png');
            --popup-bg-justice: url('images/popup_bg_justice.png');
            --popup-bg-thehangedman: url('images/popup_bg_the_hanged_man.png');
            --popup-bg-death: url('images/popup_bg_death.png');
            --popup-bg-temperance: url('images/popup_bg_temperance.png');
            --popup-bg-thedevil: url('images/popup_bg_the_devil.png');
            --popup-bg-thetower: url('images/popup_bg_the_tower.png');
            --popup-bg-thestar: url('images/popup_bg_the_star.png');
            --popup-bg-themoon: url('images/popup_bg_the_moon.png');
            --popup-bg-thesun: url('images/popup_bg_the_sun.png');
            --popup-bg-judgement: url('images/popup_bg_judgement.png');
            --popup-bg-theworld: url('images/popup_bg_the_world.png');

            /* --- Promo --- */
            --promo-banner-img: url('images/promo_banner.png'); 
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg-color);
            color: var(--primary-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            transition: opacity 0.5s ease;
        }

        /* --- Screens Container --- */
        .screen {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            background-size: 100% auto;
            background-position: top center;
            background-repeat: no-repeat;
        }
        .screen.active { display: flex; opacity: 1; }

        /* Intro, Quiz, Loading, Reveal Styles */
        #intro-screen { background-image: var(--intro-background); padding: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; animation: fadeInBg 1.5s ease-out forwards; }
        .intro-content { width: 100%; padding-top: 100px; padding-left: 30px; padding-right: 30px; display: flex; flex-direction: column; align-items: center; }
        #intro-desc { color: white; margin-bottom: 40px; line-height: 1.7; text-align: center; font-family: 'Kanit', sans-serif; font-size: 1.1rem; text-shadow: 0 2px 8px rgba(0,0,0,0.8); min-height: 200px; }
        #skip-btn { position: absolute; top: 20px; right: 20px; background: rgba(255, 255, 255, 0.15); color: rgba(255, 255, 255, 0.9); border: 1px solid rgba(255, 255, 255, 0.3); padding: 6px 14px; border-radius: 20px; font-family: 'Kanit', sans-serif; font-size: 0.85rem; cursor: pointer; z-index: 50; transition: opacity 0.5s ease-in-out; backdrop-filter: blur(4px); display: none; opacity: 0; }
        #skip-btn:hover { background: rgba(255, 255, 255, 0.3); color: white; }
        .btn-start { background: white; color: #A61F26; font-family: 'Kanit', sans-serif; font-size: 1.2rem; font-weight: 600; padding: 10px 15px; border-radius: 100vh; border: none; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.2s, box-shadow 0.2s, opacity 0.5s ease-in; width: auto; min-width: 150px; opacity: 0; pointer-events: none; }
        .btn-start.visible { opacity: 1; pointer-events: auto; }
        .btn-start:active { transform: scale(0.95); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #quiz-screen { background-color: #130023; transition: background-image 0.5s ease-in-out; padding: 0; position: relative; overflow-y: visible; display: block; }
        .progress-container { width: 90%; height: 6px; background: rgba(255,255,255,0.3); border-radius: 4px; position: fixed; top: 15px; left: 50%; transform: translateX(-50%); z-index: 100; max-width: 480px; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #ffd700, #ffecb3); width: 0%; transition: width 0.3s ease; }
        .quiz-content-wrapper { width: 100%; min-height: 100vh; display: flex; flex-direction: column; transition: opacity 0.3s ease; }
        .quiz-spacer { height: 65vh; width: 100%; flex-shrink: 0; }
        .quiz-content { width: 100%; padding: 0 30px 60px 30px; display: flex; flex-direction: column; gap: 20px; box-sizing: border-box; background: linear-gradient(to bottom, rgba(19,0,35,0) 0%, rgba(19,0,35,0.8) 20%, rgba(19,0,35,1) 100%); }
        .question-text { font-family: 'Athiti', sans-serif; font-size: 1.8rem; font-weight: 600; color: white; line-height: 1.3; text-align: left; margin-bottom: 5px; text-shadow: 0 2px 4px rgba(0,0,0,0.6); min-height: 3em; }
        .options-list { display: flex; flex-direction: column; gap: 10px; width: 100%; }
        .option-btn { background: rgba(255, 255, 255, 0.9); border: none; padding: 15px 20px; border-radius: 12px; text-align: left; font-size: 1.1rem; color: #2a2d43; cursor: pointer; transition: all 0.2s; font-family: 'Kanit', sans-serif; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .option-btn:hover { background: white; color: var(--primary-color); font-weight: 600; transform: translateX(5px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .option-btn.selected { background-color: var(--primary-color); color: white; font-weight: 600; transform: translateX(5px); box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        #flash-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: white; z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.1s ease-out; }
        #flash-overlay.flash-active { opacity: 1; }
        #loading-screen { background-image: var(--intro-background); background-size: cover; background-position: center; padding: 0; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .loader-card { font-size: 4rem; animation: spin 1s infinite linear; margin-bottom: 20px; }
        #reveal-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #130023; z-index: 100; display: none; flex-direction: column; justify-content: center; align-items: center; opacity: 0; transition: opacity 1s ease; }
        #reveal-screen.active { display: flex; opacity: 1; }
        .scene { width: 300px; height: 500px; perspective: 1000px; margin-bottom: 30px; }
        .card-object { width: 100%; height: 100%; position: relative; transition: transform 0.8s; transform-style: preserve-3d; cursor: pointer; }
        .card-object.is-flipped { transform: rotateY(180deg); }
        .card-face { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; border-radius: 20px; background-size: cover; background-position: center; box-shadow: 0 0 50px rgba(212, 163, 115, 0.4); }
        .card-back { background-image: var(--card-back); background-color: #1a1a2e; border: 2px solid var(--highlight-color); transform: rotateY(0deg); }
        .card-front { background-color: var(--primary-color); border: 2px solid var(--highlight-color); transform: rotateY(180deg); }
        .reveal-text { color: white; font-family: 'Athiti', sans-serif; font-size: 1.5rem; font-weight: 600; opacity: 0.8; animation: pulse 2s infinite; }

        /* --- RESULT SCREEN --- */
        #result-screen { 
            padding: 20px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: relative; 
            overflow: hidden; 
        }
        
        #result-screen::before {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: var(--current-result-bg, var(--result-fallback-background));
            background-size: cover;
            background-position: center;
            filter: blur(10px); 
            z-index: 0;
            opacity: 0.6; 
        }
        
        .result-image-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 450px;
            aspect-ratio: 9 / 16;
            border-radius: var(--card-radius);
            overflow: hidden;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.3s;
        }
        .result-image-container:hover {
            transform: scale(1.02);
        }
        
        #result-final-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .promo-banner {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 450px;
            aspect-ratio: 3 / 1;
            background-image: var(--promo-banner-img);
            background-size: cover;
            background-position: center;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .promo-banner:active { transform: scale(0.98); }

        .action-area { 
            position: relative;
            z-index: 1;
            width: 100%; 
            max-width: 450px;
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            padding-bottom: 30px;
        }
        
        .btn-action { 
            width: 100%; 
            padding: 16px; 
            border: none; 
            border-radius: 30px; 
            font-family: 'Kanit', sans-serif; 
            font-size: 1.1rem; 
            font-weight: 600;
            cursor: pointer; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            gap: 10px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.2); 
            transition: transform 0.2s;
        }
        .btn-action:active { transform: scale(0.95); }

        .btn-random { background: linear-gradient(135deg, #ffd700, #ffb74d); color: #2a2d43; }
        .btn-restart { background-color: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(5px); }

        /* --- POPUP (Randomizer) --- */
        #random-popup { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background-color: rgba(0, 0, 0, 0.9); z-index: 2000; 
            display: none; justify-content: center; align-items: center; 
            opacity: 0; transition: opacity 0.3s ease; 
        }
        #random-popup.active { display: flex; opacity: 1; }

        .popup-card-container {
            width: 90vh; 
            max-width: 90vw; 
            height: 80vh; 
            aspect-ratio: 9/16;
            
            /* Dynamic Background set by JS */
            background-size: cover;
            background-position: center;
            
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            border: 4px solid #ffd700;
        }

        .popup-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            z-index: 10;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }

        /* Top 40% for Product */
        .popup-top-section {
            height: 40%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding-top: 20px; 
        }

        .product-img-wrapper {
            width: 250px;
            height: 250px;
            max-width: 80%; 
            aspect-ratio: 1/1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: white; 
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            padding: 10px;
        }

        #random-result-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        /* Bottom 60% for Text & Button */
        .popup-bottom-section {
            height: 60%;
            position: relative;
            display: flex;
            flex-direction: column; /* Stack text and button */
            justify-content: center; /* Center vertically */
            align-items: center;
            padding: 20px;
            gap: 15px;
        }

        /* Promo Text Styling */
        .promo-text-container {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            font-family: 'Kanit', sans-serif;
            font-size: 0.9rem;
            color: #333;
            line-height: 1.5;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            width: 100%;
            opacity: 0; /* Hidden initially */
            transition: opacity 0.5s;
        }
        .promo-text-container.visible { opacity: 1; }

        .highlight-price {
            color: #d32f2f; /* Red for price */
            font-weight: 700;
            font-size: 1.1em;
        }

        @keyframes color-cycle {
            0% { background-color: #ff0055; }
            25% { background-color: #ffcc00; }
            50% { background-color: #00cc66; }
            75% { background-color: #0099ff; }
            100% { background-color: #cc00ff; }
        }

        .highlight-coupon {
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-family: monospace; /* Monospace for code feeling */
            font-size: 1.1em;
            letter-spacing: 1px;
            animation: color-cycle 3s infinite alternate; /* Color switching animation */
            display: inline-block;
            margin: 0 2px;
        }

        .btn-buy {
            background-color: #00C853;
            color: white;
            text-decoration: none;
            padding: 12px 30px;
            border-radius: 30px;
            text-align: center;
            font-family: 'Kanit', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(0,200,83,0.4);
            transition: transform 0.2s, opacity 0.3s;
            opacity: 0;
            pointer-events: none;
            border: 2px solid white;
            width: 100%;
        }
        .btn-buy.visible { opacity: 1; pointer-events: auto; }
        .btn-buy:active { transform: scale(0.95); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes zoomIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }

    </style>
</head>
<body>

    <!-- Flash Overlay -->
    <div id="flash-overlay"></div>

    <!-- Randomizer Popup (UPDATED Layout with Text) -->
    <div id="random-popup">
        <div class="popup-card-container">
            <div class="popup-close" onclick="closeRandomPopup()">√ó</div>
            
            <div class="popup-top-section">
                <div class="product-img-wrapper">
                    <img id="random-result-img" src="" alt="Random Gift">
                </div>
            </div>
            
            <div class="popup-bottom-section">
                <!-- Text Container (Hidden until spin stops) -->
                <div id="promo-text-box" class="promo-text-container">
                    <!-- Text injected by JS -->
                </div>
                
                <a id="buy-btn" href="#" target="_blank" class="btn-buy">üõí ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
            </div>
        </div>
    </div>

    <!-- SCREEN 1: INTRO -->
    <div id="intro-screen" class="screen active">
        <button id="skip-btn" onclick="skipIntro()">SKIP >></button>
        <div class="intro-content">
            <p id="intro-desc"></p>
            <button id="intro-btn" class="btn-start" onclick="startQuiz()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
        </div>
    </div>

    <!-- SCREEN 2: QUIZ -->
    <div id="quiz-screen" class="screen">
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div class="quiz-content-wrapper">
            <div class="quiz-spacer"></div>
            <div class="quiz-content">
                <div class="question-text" id="q-text">Loading...</div>
                <div class="options-list" id="options-container"></div>
            </div>
        </div>
    </div>

    <!-- SCREEN 4: REVEAL SCREEN -->
    <div id="reveal-screen">
        <div class="scene">
            <div class="card-object" onclick="flipCard()">
                <div class="card-face card-back">
                    <!-- Image handled by CSS -->
                </div>
                <div class="card-face card-front">
                    <!-- Image handled by CSS/JS -->
                </div>
            </div>
        </div>
        <div class="reveal-text" id="reveal-text">‡πÅ‡∏ï‡∏∞‡πÑ‡∏û‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢</div>
    </div>

    <!-- SCREEN 5: RESULT -->
    <div id="result-screen" class="screen">
        <!-- Result Image (9:16) -->
        <div class="result-image-container">
            <img id="result-final-img" src="" alt="Your Tarot Result">
        </div>

        <!-- Promo Banner -->
        <div class="promo-banner" onclick="openRandomPopup()"></div>

        <!-- Buttons -->
        <div class="action-area">
            <button class="btn-action btn-random" onclick="openRandomPopup()">
                üéÅ ‡πÄ‡∏Å‡∏°‡πÑ‡∏´‡∏ô‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì ‡∏°‡∏≤‡∏î‡∏π‡∏Å‡∏±‡∏ô!
            </button>
            <button class="btn-action btn-restart" onclick="location.reload()">
                üîÑ ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
            </button>
        </div>
    </div>

<script>
    // --- UTILS & INTRO ---
    let currentTypingTimer = null;
    const introText = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÑ‡∏û‡πà‡∏™‡∏≥‡∏£‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏ñ‡∏∑‡∏≠‡∏Å‡∏≥‡πÄ‡∏ô‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏î ‡∏£‡∏π‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ß‡πà‡∏≤‡∏°‡∏±‡∏ô‡∏°‡∏±‡∏Å‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡πÄ‡∏Å‡∏° ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏≤‡∏Å‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ñ‡∏π‡∏Å‡∏™‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏ô‡∏±‡πâ‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á<br><br>‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡πÄ‡∏á‡∏≤‡∏°‡∏∑‡∏î‡∏Ç‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞ ‡∏¢‡∏±‡∏á‡∏°‡∏µ ‚Äú‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‚Äù ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÑ‡∏û‡πà‡πÉ‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏≠‡∏Å‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï ‡∏°‡∏±‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏£‡∏∞‡∏ã‡∏¥‡∏ö‡∏ß‡πà‡∏≤ <br><br>\"‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÉ‡∏ô‡πÄ‡∏Å‡∏°‡∏Ñ‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á\"<br><br>‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÑ‡∏û‡πà‡∏™‡∏≥‡∏£‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏≠‡∏á‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏°‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÅ‡∏ó‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏Å‡∏°‡∏ô‡∏±‡πâ‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏à‡∏ö ‡∏°‡∏±‡∏ô‡πÅ‡∏Ñ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡πÑ‡∏õ ‡∏Å‡πá‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô...";

    function typeWriter(elementId, text, speed = 30, callback = null) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        element.innerHTML = '';
        if (currentTypingTimer) clearTimeout(currentTypingTimer);
        
        let i = 0;
        
        function type() {
            if (i < text.length) {
                if (text.substring(i).startsWith('<br>')) { element.innerHTML += '<br>'; i += 4; } 
                else { element.innerHTML += text.charAt(i); i++; }
                currentTypingTimer = setTimeout(type, speed);
            } else { if (callback) callback(); }
        }
        type();
    }

    function skipIntro() {
        if (currentTypingTimer) clearTimeout(currentTypingTimer);
        document.getElementById('intro-desc').innerHTML = introText;
        document.getElementById('intro-btn').classList.add('visible');
        const skipBtn = document.getElementById('skip-btn');
        if(skipBtn) skipBtn.style.display = 'none';
    }

    window.onload = function() {
        setTimeout(() => {
            const skipBtn = document.getElementById('skip-btn');
            if(skipBtn) skipBtn.style.display = 'block';
            setTimeout(() => { skipBtn.style.opacity = '1'; }, 10);
            typeWriter('intro-desc', introText, 30, () => {
                document.getElementById('intro-btn').classList.add('visible');
                if(skipBtn) skipBtn.style.display = 'none';
            });
        }, 1500); 
    };

    // --- DATA ---
    const questions = [
        {
            q: "1. ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏ó‡∏∏‡πà‡∏á‡∏´‡∏ç‡πâ‡∏≤‡∏≠‡∏±‡∏ô‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡πÉ‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏û‡∏ö‡∏Å‡∏≠‡∏á‡πÑ‡∏û‡πà‡∏Å‡∏≠‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡πÑ‡∏û‡πà‡∏Ñ‡∏ß‡πà‡∏≥‡πÅ‡∏¢‡∏Å‡πÑ‡∏ß‡πâ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏°‡∏±‡∏ô‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏´‡∏¢‡∏¥‡∏ö‡∏°‡∏±‡∏ô‡∏°‡∏≤‡∏ô‡∏≤‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?",
            color: "#4a4e69",
            options: [
                { text: "1. ‡∏´‡∏¢‡∏¥‡∏ö‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏î‡∏π‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏£‡∏π‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå", scores: { R: 2, T: 1 } },
                { text: "2. ‡∏™‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏î‡∏ß‡∏á‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô", scores: { R: 1, O: 1 } },
                { text: "3. ‡∏ï‡∏£‡∏ß‡∏à‡∏î‡∏π‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î", scores: { O: 2, S: 1 } },
                { text: "4. ‡∏ä‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏°‡∏≤‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ô", scores: { C: 2, O: 1 } },
                { text: "5. ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡∏£‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°", scores: { S: 2, O: 1 } }
            ]
        },
        {
            q: "2. ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ï‡πà‡∏≠ ‡πÅ‡∏ï‡πà‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?",
            color: "#9a8c98",
            options: [
                { text: "1. ‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡∏ó‡∏≤‡∏á‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏≠‡∏á", scores: { R: 2, T: 1 } },
                { text: "2. ‡∏´‡∏¢‡∏∏‡∏î‡∏Ñ‡∏¥‡∏î ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏™‡πâ‡∏ô", scores: { R: 1, T: 1 } },
                { text: "3. ‡∏°‡∏≠‡∏á‡∏´‡∏≤‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à", scores: { O: 2, S: 1 } },
                { text: "4. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å ‚Äú‡πÉ‡∏ä‡πà‚Äù ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô", scores: { C: 2, O: 1 } },
                { text: "5. ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Ñ‡∏£‡∏™‡∏±‡∏Å‡∏Ñ‡∏ô‡∏°‡∏≤‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à", scores: { S: 2, O: 1 } }
            ]
        },
        {
            q: "3. ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏õ‡∏Å‡∏ï‡∏¥‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?",
            color: "#c9ada7",
            options: [
                { text: "1. ‡πÄ‡∏£‡πà‡∏á‡∏ù‡∏µ‡πÄ‡∏ó‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ó‡∏±‡∏ô‡∏ó‡∏µ", scores: { R: 2, T: 1 } },
                { text: "2. ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏ï‡∏¥ ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ß‡πà‡∏≤‡πÄ‡∏á‡∏≤‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏†‡∏±‡∏¢‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ß", scores: { T: 1, R: 1 } },
                { text: "3. ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡πÄ‡∏ù‡πâ‡∏≤‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏á‡∏µ‡∏¢‡∏ö ‡πÜ", scores: { S: 2, O: 1 } },
                { text: "4. ‡∏´‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏´‡∏ô‡πâ‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î‡∏°‡∏±‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏ô", scores: { C: 2, S: 1 } },
                { text: "5. ‡πÉ‡∏ä‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏≠‡πâ‡∏≠‡∏° ‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô", scores: { O: 1, S: 2 } }
            ]
        },
        {
            q: "4. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏ö‡∏´‡∏ô‡∏µ‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏≤‡∏°‡∏∑‡∏î‡∏°‡∏µ‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÅ‡∏¢‡πà‡∏•‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡πÅ‡∏ó‡∏ô?",
            color: "#d4a373",
            options: [
                { text: "1. ‡∏≠‡∏î‡∏ó‡∏ô‡∏£‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÅ‡∏°‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ß", scores: { R: 1, C: 1 } },
                { text: "2. ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏∏‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå", scores: { O: 1, R: 1 } },
                { text: "3. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á ‡∏Ñ‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏Ñ‡∏¥‡∏î‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô", scores: { O: 2, S: 1 } },
                { text: "4. ‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏°‡∏¥‡∏ï‡∏£‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß", scores: { C: 2, O: 1 } },
                { text: "5. ‡∏¢‡∏≠‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏ö‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏ß‡πà‡∏≤", scores: { S: 2, C: 1 } }
            ]
        },
        {
            q: "5. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡∏ñ‡∏≠‡∏¢‡∏≠‡∏µ‡∏Å‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏´‡∏¢‡∏±‡∏î‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö‡πÉ‡∏î?",
            color: "#2a2d43",
            options: [
                { text: "1. ‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡πÉ‡∏à‡∏•‡πâ‡∏ß‡∏ô ‡πÜ ‡∏î‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÑ‡∏õ‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ", scores: { R: 2, T: 1 } },
                { text: "2. ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ß‡∏Ñ‡∏£‡∏≠‡∏ö‡∏á‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à", scores: { R: 1, O: 1 } },
                { text: "3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ú‡∏ä‡∏¥‡∏ç‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÅ‡∏ú‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå", scores: { S: 2, O: 1 } },
                { text: "4. ‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏°‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏•‡∏Å‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á", scores: { C: 2, S: 1 } },
                { text: "5. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏Ç‡∏≠‡∏á‡∏°‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°", scores: { S: 1, O: 2 } }
            ]
        },
        {
            q: "6. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?",
            color: "#5e548e",
            options: [
                { text: "1. ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏°‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡∏Ñ‡∏≤‡∏î‡πÄ‡∏î‡∏≤‡∏¢‡∏≤‡∏Å", scores: { T: 2, R: 1 } },
                { text: "2. ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏î‡∏£‡∏≠‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß", scores: { R: 1, O: 1 } },
                { text: "3. ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", scores: { S: 2, O: 1 } },
                { text: "4. ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô‡∏£‡∏≠‡∏ö‡∏Ç‡πâ‡∏≤‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î", scores: { C: 2, O: 1 } },
                { text: "5. ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏°‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏®‡∏π‡∏ô‡∏¢‡πå", scores: { S: 2, T: 1 } }
            ]
        },
        {
            q: "7. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏∞‡∏ó‡∏∞‡∏à‡∏ö‡∏•‡∏á ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏∑‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πà‡∏≤‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏ä‡∏±‡∏¢‡∏ä‡∏ô‡∏∞ ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏î‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ä‡∏±‡∏¢‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì?",
            color: "#231942",
            options: [
                { text: "1. ‡∏â‡∏±‡∏ô‡∏û‡∏¥‡∏™‡∏π‡∏à‡∏ô‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤ ‚Äú‡∏Å‡∏•‡πâ‡∏≤‡∏•‡∏á‡∏°‡∏∑‡∏≠‚Äù ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô", scores: { R: 2, T: 1 } },
                { text: "2. ‡∏â‡∏±‡∏ô‡∏ä‡∏ô‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á", scores: { S: 2, O: 1 } },
                { text: "3. ‡∏â‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô ‡∏ß‡πà‡∏≤‡∏à‡∏£‡∏¥‡∏á ‡πÜ ‡πÅ‡∏•‡πâ‡∏ß‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏Ñ‡∏£", scores: { O: 2, S: 1 } },
                { text: "4. ‡∏â‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏ä‡∏ô‡∏∞‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏û‡∏±‡∏á ‡∏™‡∏¥‡πà‡∏á‡∏£‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏Ñ‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢", scores: { C: 2, O: 1 } },
                { text: "5. ‡∏ä‡∏±‡∏¢‡∏ä‡∏ô‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏à‡∏∏‡∏î‡∏à‡∏ö ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∑‡∏≠‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà", scores: { R: 1, S: 1 } }
            ]
        }
    ];

    // Added 'coupon' key to each card
    const tarotCards = [
        { id: 0, name: 'The Fool', title: 'The Explorer', emoji: 'üéí', main: 'R', sub: 'T', coupon: 'TOWERTF' },
        { id: 1, name: 'The Magician', title: 'The Strategist', emoji: '‚ú®', main: 'S', sub: 'T', coupon: 'TOWERMG' },
        { id: 2, name: 'The High Priestess', title: 'The Intuitive', emoji: 'üåô', main: 'O', sub: 'S', coupon: 'TOWERHP' },
        { id: 3, name: 'The Empress', title: 'The Nurturer', emoji: 'üå∏', main: 'C', sub: 'O', coupon: 'TOWERES' },
        { id: 4, name: 'The Emperor', title: 'The Leader', emoji: 'üëë', main: 'S', sub: 'O', coupon: 'TOWEREM' },
        { id: 5, name: 'The Hierophant', title: 'The Traditionalist', emoji: 'üìú', main: 'O', sub: 'C', coupon: 'TOWERHT' },
        { id: 6, name: 'The Lovers', title: 'The Connector', emoji: '‚ù§Ô∏è', main: 'C', sub: 'R', coupon: 'TOWERLV' },
        { id: 7, name: 'The Chariot', title: 'The Competitor', emoji: 'üèÅ', main: 'T', sub: 'R', coupon: 'TOWERCR' },
        { id: 8, name: 'Strength', title: 'The Calm Power', emoji: 'ü¶Å', main: 'C', sub: 'R', coupon: 'TOWERST' },
        { id: 9, name: 'The Hermit', title: 'The Thinker', emoji: 'üïØÔ∏è', main: 'S', sub: 'O', coupon: 'TOWERHM' },
        { id: 10, name: 'Wheel of Fortune', title: 'The Risk Taker', emoji: 'üé≤', main: 'R', sub: 'T', coupon: 'TOWERWF' },
        { id: 11, name: 'Justice', title: 'The Balancer', emoji: '‚öñÔ∏è', main: 'O', sub: 'S', coupon: 'TOWERJT' },
        { id: 12, name: 'The Hanged Man', title: 'The Outsider', emoji: 'üîÑ', main: 'O', sub: 'C', coupon: 'TOWERGM' }, // Note: HM same as Hermit in prompt
        { id: 13, name: 'Death', title: 'The Transformer', emoji: 'üíÄ', main: 'R', sub: 'S', coupon: 'TOWERDE' },
        { id: 14, name: 'Temperance', title: 'The Harmonizer', emoji: 'üåà', main: 'C', sub: 'O', coupon: 'TOWERTP' },
        { id: 15, name: 'The Devil', title: 'The Trickster', emoji: 'üòà', main: 'R', sub: 'C', coupon: 'TOWERDV' },
        { id: 16, name: 'The Tower', title: 'The Chaos Bringer', emoji: '‚ö°', main: 'R', sub: 'T', coupon: 'TOWERTW' },
        { id: 17, name: 'The Star', title: 'The Optimist', emoji: '‚ú®', main: 'C', sub: 'O', coupon: 'TOWERSR' },
        { id: 18, name: 'The Moon', title: 'The Deceiver', emoji: 'üåë', main: 'O', sub: 'R', coupon: 'TOWERMO' },
        { id: 19, name: 'The Sun', title: 'The Entertainer', emoji: '‚òÄÔ∏è', main: 'T', sub: 'C', coupon: 'TOWERTS' },
        { id: 20, name: 'Judgement', title: 'The Challenger', emoji: 'üîî', main: 'S', sub: 'C', coupon: 'TOWERJM' },
        { id: 21, name: 'The World', title: 'The Mastermind', emoji: 'üåç', main: 'O', sub: 'C', coupon: 'TOWERWO' }
    ];

    // --- PRODUCTS DATA (Updated with names) ---
    const products = [
        { img: 'images/product_1.png', url: 'https://shopee.co.th/product/779557916/21238938993', name: '27 METRES TH/EN' },
        { img: 'images/product_2.png', url: 'https://shopee.co.th/product/779557916/27618023413', name: 'PIXIES TH/EN' },
        { img: 'images/product_3.png', url: 'https://shopee.co.th/product/779557916/26429058740', name: 'HANABI ‡∏Æ‡∏≤‡∏ô‡∏≤‡∏ö‡∏¥ TH' },
        { img: 'images/product_4.png', url: 'https://shopee.co.th/product/779557916/28416603796', name: 'TACO KITTEN PIZZA ‡∏ó‡∏≤‡πÇ‡∏Å‡πâ ‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ß ‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤ TH/EN' },
        { img: 'images/product_5.png', url: 'https://shopee.co.th/product/779557916/46500929461', name: 'FLIP 7 ‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ TH/EN' },
        { img: 'images/product_6.png', url: 'https://shopee.co.th/product/779557916/25513307654', name: 'SEA, SALT & PAPER ‡∏ó‡∏∞‡πÄ‡∏• ‡πÄ‡∏Å‡∏•‡∏∑‡∏≠ ‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡∏∑‡∏≠‡∏û‡∏±‡∏ö TH/EN' },
        { img: 'images/product_7.png', url: 'https://shopee.co.th/product/779557916/23153784139', name: 'TACO CAT GOAT CHEESE PIZZA ‡∏ó‡∏≤‡πÇ‡∏Å‡πâ ‡πÅ‡∏°‡∏ß ‡πÅ‡∏û‡∏∞ ‡∏ä‡∏µ‡∏™ ‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤ TH/EN' },
        { img: 'images/product_8.png', url: 'https://shopee.co.th/product/779557916/25872428455', name: 'TRIO TH/EN' },
        { img: 'images/product_9.png', url: 'https://shopee.co.th/product/779557916/28514424251', name: 'YOGI ‡πÇ‡∏¢‡∏Ñ‡∏µ 2ND EDITION TH' }
    ];

    // Card Name to Product Index Mapping (0-8) - Matches Product Index
    const cardToProductIndex = {
        "The Lovers": 0, "Justice": 0, "The World": 0, // product_1
        "Strength": 1, "The Sun": 1, "Death": 1, // product_2
        "The Fool": 2, "Judgement": 2, "The Tower": 2, // product_3
        "Wheel of Fortune": 3, "The High Priestess": 3, "The Hanged Man": 3, // product_4
        "The Chariot": 4, "The Magician": 4, // product_5
        "The Devil": 5, "The Moon": 5, // product_6
        "Temperance": 6, "The Emperor": 6, // product_7
        "The Empress": 7, "The Hierophant": 7, // product_8
        "The Star": 8, "The Hermit": 8 // product_9
    };

    let currentQIndex = 0;
    let scores = { S: 5, T: 5, C: 5, R: 5, O: 5 };
    let currentBestCard = null; 
    let randomInterval = null;

    // ... (StartQuiz, RenderQuestion, SelectOption, TriggerFinish - Unchanged) ...
    function startQuiz() {
        scrollToTop();
        const introScreen = document.getElementById('intro-screen');
        const quizScreen = document.getElementById('quiz-screen');
        introScreen.style.opacity = '0';
        setTimeout(() => {
            introScreen.classList.remove('active');
            introScreen.style.display = 'none';
            quizScreen.style.display = 'block';
            quizScreen.classList.add('active');
            quizScreen.style.opacity = '0';
            setTimeout(() => {
                quizScreen.style.opacity = '1';
                renderQuestion();
            }, 50);
        }, 800); 
    }

    function renderQuestion() {
        scrollToTop();
        const qData = questions[currentQIndex];
        const percent = ((currentQIndex) / questions.length) * 100;
        document.getElementById('progressBar').style.width = percent + '%';
        typeWriter('q-text', qData.q, 40); 
        
        const quizScreen = document.getElementById('quiz-screen');
        const bgVars = ['--quiz-first-background', '--quiz-second-background', '--quiz-third-background', '--quiz-fourth-background', '--quiz-fifth-background', '--quiz-sixth-background', '--quiz-seventh-background'];
        if (quizScreen) quizScreen.style.backgroundImage = `var(${bgVars[currentQIndex]})`;

        const optsContainer = document.getElementById('options-container');
        optsContainer.innerHTML = '';
        qData.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.text;
            btn.style.animation = `fadeIn 0.3s ease forwards ${0.2 + (idx * 0.1)}s`; 
            btn.style.opacity = '0'; 
            btn.onclick = (e) => selectOption(e.target, opt.scores);
            optsContainer.appendChild(btn);
        });
    }

    function selectOption(btn, points) {
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true); 
        btn.classList.add('selected');
        for (let key in points) scores[key] += points[key];
        setTimeout(() => {
            const contentWrapper = document.querySelector('.quiz-content-wrapper');
            contentWrapper.style.opacity = '0';
            setTimeout(() => {
                scrollToTop();
                currentQIndex++;
                if (currentQIndex < questions.length) {
                    renderQuestion();
                    contentWrapper.style.opacity = '1';
                } else {
                    triggerFinish();
                }
            }, 300);
        }, 600);
    }

    function triggerFinish() {
        document.getElementById('progressBar').style.width = '100%';
        setTimeout(() => {
            const flashOverlay = document.getElementById('flash-overlay');
            flashOverlay.classList.add('flash-active');
            setTimeout(() => {
                const quizScreen = document.getElementById('quiz-screen');
                quizScreen.classList.remove('active');
                quizScreen.style.display = 'none';
                calculateResult(); 
                setTimeout(() => { flashOverlay.classList.remove('flash-active'); }, 100);
            }, 500);
        }, 500);
    }

    function calculateResult() {
        for (let key in scores) scores[key] = Math.min(10, Math.max(1, scores[key]));
        let candidates = [];
        let maxMatchScore = -1;
        tarotCards.forEach(card => {
            let match = (scores[card.main] * 2) + (scores[card.sub] * 1);
            if (match > maxMatchScore) { maxMatchScore = match; candidates = [card]; } 
            else if (match === maxMatchScore) { candidates.push(card); }
        });

        const topCandidate = candidates[0];
        let finalCardName = topCandidate.name;
        
        if (candidates.some(c => c.name === 'The Emperor') && candidates.some(c => c.name === 'The Hermit')) {
             if (scores.C >= 6) finalCardName = 'The Emperor'; else if (scores.C <= 4) finalCardName = 'The Hermit'; else if (scores.C === 5) { if (scores.T >= 6) finalCardName = 'The Emperor'; else finalCardName = 'The Hermit'; }
        }
        else if (candidates.some(c => c.name === 'The Fool')) {
            if (scores.S <= 4 && scores.O <= 4) finalCardName = 'The Fool'; else if (scores.S >= 5 && scores.S <= 6 && scores.O >= 4 && scores.O <= 5) finalCardName = 'Wheel of Fortune'; else if (scores.S >= 6 && scores.O <= 3) finalCardName = 'The Tower'; else finalCardName = 'Wheel of Fortune';
        }
        else if (candidates.some(c => c.name === 'The High Priestess') && candidates.some(c => c.name === 'Justice')) {
            if (scores.C <= 4) finalCardName = 'The High Priestess'; else if (scores.C >= 6) finalCardName = 'Justice'; else if (scores.C === 5) { if (scores.R <= 4) finalCardName = 'Justice'; else finalCardName = 'The High Priestess'; }
        }
        else if (candidates.some(c => c.name === 'The Empress')) {
            if (scores.T >= 6) finalCardName = 'The Empress'; else if (scores.T >= 4 && scores.T <= 5 && scores.S >= 6) finalCardName = 'Temperance'; else if (scores.T <= 4) finalCardName = 'The Star'; else finalCardName = 'Temperance';
        }
        else if (candidates.some(c => c.name === 'The Hierophant')) {
            if (scores.S <= 4 && scores.O >= 6) finalCardName = 'The Hierophant'; else if (scores.R >= 6) finalCardName = 'The Hanged Man'; else if (scores.S >= 5 && scores.R <= 5) finalCardName = 'The World'; else finalCardName = 'The World';
        }
        else if (candidates.some(c => c.name === 'The Lovers') && candidates.some(c => c.name === 'Strength')) {
            if (scores.R >= 6) finalCardName = 'The Lovers'; else if (scores.R <= 4) finalCardName = 'Strength'; else if (scores.R === 5) { if (scores.O >= 6) finalCardName = 'Strength'; else finalCardName = 'The Lovers'; }
        }

        const bestCard = tarotCards.find(c => c.name === finalCardName) || candidates[0];
        currentBestCard = bestCard; 

        const revealScreen = document.getElementById('reveal-screen');
        revealScreen.classList.add('active');
        revealScreen.style.opacity = '1';
        const cardObject = document.querySelector('.card-object');
        cardObject.classList.remove('is-flipped');
        document.getElementById('reveal-text').innerText = "‡πÅ‡∏ï‡∏∞‡πÑ‡∏û‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢";
        const cardVarName = `--card-front-${bestCard.name.toLowerCase().replace(/ /g, '')}`;
        document.querySelector('.card-front').style.backgroundImage = `var(${cardVarName})`;
    }

    function flipCard() {
        const cardObject = document.querySelector('.card-object');
        if (cardObject.classList.contains('is-flipped')) return; 
        cardObject.classList.add('is-flipped');
        document.getElementById('reveal-text').innerText = currentBestCard.name;
        setTimeout(() => {
            const revealScreen = document.getElementById('reveal-screen');
            revealScreen.style.opacity = '0';
            setTimeout(() => {
                revealScreen.classList.remove('active');
                renderResult(currentBestCard);
            }, 1000); 
        }, 2500); 
    }

    function renderResult(card) {
        scrollToTop();
        const resultScreen = document.getElementById('result-screen');
        resultScreen.classList.add('active');
        setTimeout(() => { resultScreen.style.opacity = '1'; }, 100);

        const resultImgUrl = `images/summary_${card.name.toLowerCase().replace(/ /g, '_')}.png`;
        document.getElementById('result-final-img').src = resultImgUrl;
        
        const bgVarName = `--result-${card.name.toLowerCase().replace(/ /g, '')}-background`;
        resultScreen.style.setProperty('--current-result-bg', `var(${bgVarName})`);
    }

    // --- RANDOMIZER LOGIC (UPDATED) ---
    function openRandomPopup() {
        const popup = document.getElementById('random-popup');
        const img = document.getElementById('random-result-img');
        const buyBtn = document.getElementById('buy-btn');
        const container = document.querySelector('.popup-card-container');
        const textBox = document.getElementById('promo-text-box');
        
        // 1. Set Background based on Current Best Card
        if (currentBestCard) {
            const bgVarName = `--popup-bg-${currentBestCard.name.toLowerCase().replace(/ /g, '')}`;
            container.style.backgroundImage = `var(${bgVarName})`;
        }

        popup.classList.add('active');
        buyBtn.classList.remove('visible'); 
        textBox.classList.remove('visible'); // Hide text initially
        
        // Determine Target Product and Coupon
        let targetIndex = 0;
        let couponCode = 'TOWERGAME'; // Default fallback
        if (currentBestCard && cardToProductIndex.hasOwnProperty(currentBestCard.name)) {
            targetIndex = cardToProductIndex[currentBestCard.name];
            couponCode = currentBestCard.coupon;
        }

        // Start Cycling
        let i = 0;
        randomInterval = setInterval(() => {
            img.src = products[i].img; 
            i = (i + 1) % products.length;
        }, 100); 

        // Stop after 3 seconds
        setTimeout(() => {
            clearInterval(randomInterval);
            const finalProduct = products[targetIndex];
            
            img.src = finalProduct.img;
            buyBtn.href = finalProduct.url; 
            
            // Set Promo Text with Coupon
            textBox.innerHTML = `‡πÄ‡∏£‡∏≤‡∏Ç‡∏≠‡∏°‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏™‡∏∏‡∏î‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏° <strong>${finalProduct.name}</strong> ‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á <span class="highlight-price">399 ‡∏ö‡∏≤‡∏ó</span>‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô<br><br>‡πÇ‡∏î‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡∏Å‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡∏•‡∏±‡∏ö <span class="highlight-coupon">${couponCode}</span> ‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢`;
            
            // Show elements
            buyBtn.classList.add('visible');
            textBox.classList.add('visible');
        }, 3000);
    }

    function closeRandomPopup() {
        const popup = document.getElementById('random-popup');
        popup.classList.remove('active');
        if (randomInterval) clearInterval(randomInterval);
    }

    function captureAndShare() {
        const captureElement = document.getElementById('result-capture-area');
        const btn = document.querySelector('.btn-share');
        const originalText = btn.innerHTML;
        btn.innerText = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û...';

        htmlToImage.toPng(captureElement, { quality: 1.0, pixelRatio: 2 })
            .then(function (dataUrl) {
                const link = document.createElement('a');
                link.download = 'boardgame-personality-story.png';
                link.href = dataUrl;
                link.click();
                btn.innerHTML = originalText;
                alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÑ‡∏õ‡πÅ‡∏ä‡∏£‡πå‡∏ï‡πà‡∏≠‡πÉ‡∏ô Stories ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢");
            })
            .catch(function (error) {
                console.error('oops, something went wrong!', error);
                btn.innerHTML = originalText;
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û");
            });
    }

    function scrollToTop() {
        window.scrollTo(0,0);
    }
</script>

</body>
</html>